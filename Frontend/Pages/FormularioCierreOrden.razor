@using System.Net.Http.Json
@inject HttpClient Http
@using Frontend.DTOs



<div class="card mt-3 p-3">
    <h4>Orden @Orden?.nroOrden</h4>

    <div class="mb-2">
        <label>Observación</label>
        <textarea class="form-control" @bind="Observacion"></textarea>
    </div>

    <div class="mb-2">
        <label>Motivo fuera de servicio</label>
        <input class="form-control" @bind="MotivoTipo" />
    </div>

    <div class="mb-2">
        <label>Comentario</label>
        <textarea class="form-control" @bind="Comentario"></textarea>
    </div>

    <div class="form-check">
        <input type="checkbox" class="form-check-input" @bind="Confirmar" />
        <label class="form-check-label">Confirmar cierre</label>
    </div>

    <div class="mt-3">
        <button class="btn btn-success me-2" @onclick="CerrarOrden">Cerrar</button>
        <button class="btn btn-secondary" @onclick="OnCerrar">Cancelar</button>
    </div>

    @if (Mensaje != null)
    {
        <div class="alert alert-info mt-3">@Mensaje</div>
    }
</div>

@code {
    [Parameter] public OrdenDTO? Orden { get; set; }
    [Parameter] public EventCallback OnCerrar { get; set; }

    private string? Observacion;
    private string? MotivoTipo;
    private string? Comentario;
    private bool Confirmar;
    private string? Mensaje;

    private async Task CerrarOrden()
    {
        if (Orden == null) return;

        var request = new
        {
            nroOrden = Orden.nroOrden,
            observacion = Observacion,
            motivoTipo = MotivoTipo,
            comentario = Comentario,
            confirmar = Confirmar
        };

        var resp = await Http.PostAsJsonAsync("api/cierreorden/cerrar", request);
        Mensaje = await resp.Content.ReadAsStringAsync();
    }


}
